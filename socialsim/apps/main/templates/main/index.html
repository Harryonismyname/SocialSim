<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="https://code.jquery.com/jquery-3.5.0.js"></script>
        <script type="text/javascript" src="https://unpkg.com/vis-data@latest/peer/umd/vis-data.min.js"></script>
        <script type="text/javascript" src="https://unpkg.com/vis-network@latest/peer/umd/vis-network.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://unpkg.com/vis-network/styles/vis-network.min.css">
        <title>Document</title>
    </head>
    <body>
        <form action="/main/create/character" method="POST">
            {% csrf_token %}
            <input type="text" name="first_name" placeholder="First Name">
            <input type="text" name="last_name" placeholder="Last Name">
            <input type="number" name="age" placeholder="0">
            <input type="text" name="title" placeholder="Title">
            <button type="submit">Submit</button>
        </form>
        <p>Add connections</p>
        <form action="/main/create/connection" method="POST">
            {% csrf_token %}
            <select name="who" id="who">
                {% for character in characters %}
                    <option id="{{character.id}}" value="{{character.id}}">{{character.first_name}} {{character.last_name}}</option>
                {% endfor %}
            </select>
            <select name="to_whom" id="to_whom">
                {% for character in characters %}
                    <option id="{{character.id}}" value="{{character.id}}">{{character.first_name}} {{character.last_name}}</option>
                {% endfor %}
            </select>
            <button type="submit">Submit</button>
        </form>
        <ul>
            {% for character in characters %}
                <li id="{{character.id}}" class="character">{{character.first_name}} {{character.last_name}}</li>
                <ul>
                    {% for connection in character.connections.all %}
                    <li title="{{connection.contact.id}}" id="{{connection.owner.id}}" class="contact"><p>{{connection.contact.first_name}} {{connection.contact.last_name}}</p><button>{{connection.opinion}}</button></li>
                    {% endfor %}
                </ul>
            {% endfor %}
        </ul>
        <div id="mynetwork"></div>
        <script type="text/javascript">
        var characters = document.getElementsByClassName("character")
        var dataSet =[]
        for(const character of characters){
            var node ={ id: character.id, label: character.textContent};
            dataSet.push(node);
            }
        // create an array with nodes
        var connections = document.getElementsByClassName("contact")
        var dataBlock= []
        var nodes = new vis.DataSet(dataSet);
        for(const connection of connections){
            console.log(connection)
            var id = connection.id
            var title = connection.title
            var dupes = 0
            for(const data of dataBlock){
                var occurences = 0
                if(id == data.to && title== data.from){
                    occurences++
                    dupes++
                }
            }
            if(dupes==1){
                continue
            }
            else{
                var edge = {from:id, to:title, value:occurences};
                console.log(edge)
                dataBlock.push(edge);
                console.log(dataBlock)
            }
        }
        // create an array with edges
        var edges = new vis.DataSet(dataBlock);

        // create a network
        var container = document.getElementById("mynetwork");
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {};
        var network = new vis.Network(container, data, options);
        </script>
    </body>
</html>